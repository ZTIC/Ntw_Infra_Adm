http:
  middlewares:
    # Middleware de compressão
    compress:
      compress: {}
    
    # Middleware de rate limiting
    ratelimit:
      rateLimit:
        average: 100
        burst: 50
    
    # Middleware de segurança
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        customFrameOptionsValue: "SAMEORIGIN"
    
    # Middleware para APIs
    api-strip-prefix:
      stripPrefix:
        prefixes:
          - "/api"
    
    # Middleware para monitoramento
    prometheus@internal:
      prometheus: {}

  routers:
    # Dashboard do Traefik
    traefik-dashboard:
      rule: "Host(`traefik.${TRAEFIK_HOST:-oms.local}`)"
      service: api@internal
      middlewares:
        - security-headers
      tls:
        certResolver: letsencrypt
    
    # Aplicação principal
    app-router:
      rule: "Host(`${TRAEFIK_HOST:-oms.local}`)"
      service: app-service
      middlewares:
        - compress
        - security-headers
        - ratelimit
      tls:
        certResolver: letsencrypt
    
    # API endpoints
    api-router:
      rule: "Host(`${TRAEFIK_HOST:-oms.local}`) && PathPrefix(`/api`)"
      service: app-service
      middlewares:
        - api-strip-prefix
        - security-headers
      tls:
        certResolver: letsencrypt
    
    # Langflow AI
    langflow-router:
      rule: "Host(`ai.${TRAEFIK_HOST:-oms.local}`)"
      service: langflow-service
      middlewares:
        - security-headers
      tls:
        certResolver: letsencrypt

  services:
    # Serviço da aplicação (balanceamento entre NGINX)
    app-service:
      loadBalancer:
        servers:
          - url: "http://nginx1"
          - url: "http://nginx2"
          - url: "http://nginx3"
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
    
    # Serviço do Langflow
    langflow-service:
      loadBalancer:
        servers:
          - url: "http://langflow:7860"