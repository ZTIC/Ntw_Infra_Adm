{
  "nodes": [
    {
      "id": "input-node",
      "type": "ChatInput",
      "position": { "x": 100, "y": 100 },
      "data": {
        "input_value": "",
        "input_type": "str",
        "required": true
      }
    },
    {
      "id": "openai-node",
      "type": "OpenAIModel",
      "position": { "x": 400, "y": 100 },
      "data": {
        "model_name": "gpt-3.5-turbo",
        "temperature": 0.7,
        "max_tokens": 1000,
        "api_key": "{{OPENAI_API_KEY}}"
      }
    },
    {
      "id": "prompt-node",
      "type": "Prompt",
      "position": { "x": 250, "y": 300 },
      "data": {
        "template": "Voc√™ √© o Order Assistant, um assistente especializado em processamento de pedidos.\n\nSistema:\n- Banco de dados MySQL com tabela 'orders'\n- API REST dispon√≠vel em http://app:3000\n- Event Hub para streaming de eventos\n\nCapacidades dispon√≠veis:\n1. Consultar pedidos por ID\n2. Listar pedidos recentes\n3. Ver estat√≠sticas do sistema\n4. Verificar status de pedidos\n5. Explicar o fluxo do sistema\n6. Ajudar com problemas t√©cnicos\n\nRegras:\n- Sempre responda em portugu√™s\n- Seja √∫til e amig√°vel\n- Use markdown para formata√ß√£o\n- Para IDs de pedido, use o formato ORD-123456\n- Para consultas √† API, forne√ßa exemplos de curl\n\nContexto:\n{{context}}\n\nPergunta do usu√°rio: {{question}}\n\nResposta:"
      }
    },
    {
      "id": "api-tool-node",
      "type": "Tool",
      "position": { "x": 400, "y": 500 },
      "data": {
        "name": "order_api_tool",
        "description": "Ferramenta para interagir com a API de pedidos",
        "func": "def order_api_tool(action, order_id=None):\n    \"\"\"\n    Interage com a API de pedidos.\n    \n    Args:\n        action (str): 'get_orders', 'get_order', 'get_stats', 'health'\n        order_id (str, optional): ID do pedido\n    \"\"\"\n    import requests\n    import json\n    \n    base_url = 'http://app:3000/api'\n    \n    try:\n        if action == 'get_orders':\n            response = requests.get(f'{base_url}/orders')\n            data = response.json()\n            return f\"Pedidos encontrados: {len(data) if isinstance(data, list) else 0}\"\n            \n        elif action == 'get_order' and order_id:\n            response = requests.get(f'{base_url}/orders/{order_id}')\n            if response.status_code == 200:\n                order = response.json()\n                return json.dumps(order, indent=2, ensure_ascii=False)\n            else:\n                return f\"Pedido {order_id} n√£o encontrado\"\n                \n        elif action == 'get_stats':\n            response = requests.get(f'{base_url}/stats')\n            stats = response.json()\n            return f\"\"\"üìä Estat√≠sticas do Sistema:\n            ‚Ä¢ Total de Pedidos: {stats.get('total_orders', 0)}\n            ‚Ä¢ Receita Total: ‚Ç¨{stats.get('total_revenue', 0):.2f}\n            ‚Ä¢ Pedidos Hoje: {stats.get('today_orders', 0)}\n            \"\"\"\n            \n        elif action == 'health':\n            response = requests.get(f'http://app:3000/health')\n            return response.json()\n            \n    except Exception as e:\n        return f\"Erro na API: {str(e)}\"\n    \n    return \"A√ß√£o n√£o reconhecida\""
      }
    },
    {
      "id": "output-node",
      "type": "ChatOutput",
      "position": { "x": 700, "y": 300 },
      "data": {}
    },
    {
      "id": "parser-node",
      "type": "CustomComponent",
      "position": { "x": 550, "y": 100 },
      "data": {
        "code": "def parse_user_query(query):\n    \"\"\"\n    Analisa a consulta do usu√°rio e determina a a√ß√£o.\n    \"\"\"\n    query_lower = query.lower()\n    \n    # Mapeamento de inten√ß√µes\n    if any(word in query_lower for word in ['pedido', 'order', 'ord-']):\n        # Extrai ID do pedido se mencionado\n        import re\n        order_id_match = re.search(r'ORD-[A-Z0-9]+', query, re.IGNORECASE)\n        order_id = order_id_match.group(0) if order_id_match else None\n        \n        if order_id:\n            return {'action': 'get_order', 'order_id': order_id}\n        else:\n            return {'action': 'get_orders'}\n            \n    elif any(word in query_lower for word in ['estat√≠stica', 'stats', 'dados', 'n√∫meros']):\n        return {'action': 'get_stats'}\n        \n    elif any(word in query_lower for word in ['sa√∫de', 'health', 'status', 'funcionando']):\n        return {'action': 'health'}\n        \n    elif any(word in query_lower for word in ['ajuda', 'help', 'como usar']):\n        return {'action': 'help'}\n        \n    else:\n        return {'action': 'general_query'}"
      }
    }
  ],
  "edges": [
    {
      "source": "input-node",
      "target": "parser-node",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "source": "parser-node",
      "target": "prompt-node",
      "sourceHandle": "output",
      "targetHandle": "context"
    },
    {
      "source": "input-node",
      "target": "prompt-node",
      "sourceHandle": "output",
      "targetHandle": "question"
    },
    {
      "source": "prompt-node",
      "target": "openai-node",
      "sourceHandle": "output",
      "targetHandle": "input"
    },
    {
      "source": "api-tool-node",
      "target": "prompt-node",
      "sourceHandle": "output",
      "targetHandle": "context"
    },
    {
      "source": "openai-node",
      "target": "output-node",
      "sourceHandle": "output",
      "targetHandle": "input"
    }
  ]
}